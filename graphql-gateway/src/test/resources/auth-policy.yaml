public-paths:
  - "/public/**"
  - "/home"
  - "/about-us"

default:
  effect: "deny"

policies:
  - id: "policy-1"
    description: "Admin access to all services"
    subjects: ["role:admin"]
    statements:
      - action: [ "read", "write" ]
        resource: ["arn:*:*:/users/*"]
        effect: "allow"
        condition:
          - "sourceIp == '10.20.11.223'"
          - "currentTimestamp() < '2021-03-01T00:00:00Z'"
          - "secureTransport()"
      - action: [ "delete" ]
        resource: ["arn:*:*:/users/*"]
        effect: "deny"

  - id: "policy-2"
    description: "Read-only access to user data"
    subjects: ["role:user"]
    statements:
      - action: [ "read" ]
        resource: ["arn:*:*:/users/*"]
        effect: "allow"
      - action: [ "delete" ]
        resource: ["arn:*:*:/users/*"]
        effect: "deny"

resources:
  - id: "userService:/users"
    type: "User"
    description: "Product service"
    actions:
      - id: "ListUsers"
        type: "read"
        operations:
          - "Query.listUsers"
      - id: "CreateUser"
        type: "write"
        operations:
          - "Mutation.createUser"

roles:
  - id: "admin"
    description: "Admin role"
    permissions:
      - "policy-1"
      - "policy-2"
      - "policy-3"

  - id: "user"
    description: "User role"
    permissions:
      - "policy-2"

  - id: "product-manager"
    description: "Product manager role"
    permissions:
      - "policy-3"